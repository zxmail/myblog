<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width,viewport-fit=cover">
    <title>{{ &title }}</title>
    <meta name="keywords" content="{{ &OPT.keywords }}" />
    <meta name="description" content="{{ &OPT.siteDescription }}" />

    <link rel="stylesheet" href="{{ &OPT.theme_github_path }}JustNews/files/swiper.min.css"/>
    <link rel='stylesheet' href='{{ &OPT.theme_github_path }}JustNews/files/fonts/fontawesome5pro-all.min.css'>
    <link rel='stylesheet' href='{{ &OPT.theme_github_path }}JustNews/files/style.css'>
    <link rel='stylesheet' href='{{ &OPT.theme_github_path }}JustNews/files/noto+serif.css' type='text/css' media='all' />
	<link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="/atom.xml">
	<link rel="shortcut icon" href="{{& OPT.theme_github_path}}JustNews/files/logo2.png" type="image/x-icon">
	{{& OPT.codeBeforHead}}

    <style>
        .breadcrumb a { color: #888; }
        .breadcrumb a:hover { color: #333; }
    </style>
</head>
<body class="m-flex"> 
	<header class="site-header">
    <div class="header-container">
        <div class="mobile-menu-toggle" id="mobile-menu-toggle"><i class="fal fa-bars"></i></div>
        <div class="header-left">
            <div class="logo-area">
                {{ #OPT.logo }}<a href="/"><img src="{{ &OPT.logo }}" alt="博客Logo" class="logo-image"></a>{{ /OPT.logo }}
                {{ #OPT.showSiteNameInHeader }}<a href="/" class="blog-name">{{ &OPT.siteName }}</a>{{ /OPT.showSiteNameInHeader }}
            </div>
            <nav class="main-nav" id="main-nav"></nav>
        </div>
        <div class="header-right">
            <div class="search-icon" id="search-toggle"><i class="fal fa-search"></i></div>
            <a href="/admin" class="login-link"><i class="fal fa-user-circle"></i></a>
        </div>
    </div>
	<div class="search-box-container" id="search-box"></div>
</header>
    <div id="wrap" class="container">
        <div class="main-layout">
            <div id="post-{{ &articleSingle.id }}" class="left-column post-article">
                <article>
                    <div class="entry-card">
                        <div class="breadcrumb" style="margin-bottom: 23px; font-size: 14px; color: #888;">{{{ articleBreadcrumb }}}</div>
                        <div class="entry-head">
                            <h1 class="entry-title">{{ &articleSingle.title }}</h1>
                            <div class="entry-info"></div>
                        </div>
                        <div class="entry-content">{{{ articleSingle.content }}}</div>
                        <div class="entry-footer"></div>
                    </div>
                    <div id="comments" class="entry-comments entry-card">{{ &OPT.commentCode }}</div>
                </article>
            </div>

            <aside class="right-column">
                <div class="sidebar-sticky-wrapper">
                    <div class="widget widget-recent-posts">
                        <h3 class="widget-title">热门文章</h3>
                        <ul>
                            {{#widgetRecentlyList}}
                            <li class="recent-article-item-box">
                                {{#firstImageUrl}}
                                <div class="recent-article-item-image"><a href="{{url}}"><img src="{{firstImageUrl}}" alt="{{title}}"></a></div>
                                {{/firstImageUrl}}
                                <div class="recent-article-item-content">
                                    <a href="{{url}}">{{title}}</a>
                                    <span class="recent-article-item-date">{{createDate10}}</span>
                                </div>
                            </li>
                            {{/widgetRecentlyList}}
                        </ul>
                    </div>
                    <div class="widget widget-categories">
                        <h3 class="widget-title">分类目录</h3>
                        <ul>
                            {{#widgetCategoryList}}
                            <li><a href="/category/{{name}}/"> <i class="{{icon}}"></i> {{name}}</a></li>
                            {{/widgetCategoryList}}
                        </ul>
                    </div>
                    <div class="widget widget-tags">
                        <h3 class="widget-title">标签</h3>
                        <div class="tag-cloud">
                            <a href="#">示例标签</a>
                            <a href="#">Cloudflare</a>
                            <a href="#">Workers</a>
                            <a href="#">Blog</a>
                        </div>
                    </div>
                    <div class="widget widget-comments">
                        <h3 class="widget-title">最近评论</h3>
                        <ul>
                            <li>暂无评论</li>
                        </ul>
                    </div>
                </div>
            </aside>
        </div>
    </div>

	<footer class="footer"></footer>

    <div class="action action-style-0 action-color-0 action-pos-0"></div>
    <div class="overlay" id="overlay"></div>
    <script src="{{ &OPT.theme_github_path }}JustNews/files/swiper.min.js"></script>
    <script>
        // Your other scripts here...
    </script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        if (window.innerWidth <= 990) {
            return;
        }

        const sidebarWrapper = document.querySelector('.sidebar-sticky-wrapper');
        const mainLayout = document.querySelector('.main-layout');
        if (!sidebarWrapper || !mainLayout) {
            return;
        }

        const header = document.querySelector('.site-header');
        // Capture the initial width of the sidebar when it's not fixed
        const initialWidth = sidebarWrapper.offsetWidth;

        window.addEventListener('scroll', function() {
            const scrollTop = window.scrollY || document.documentElement.scrollTop;
            
            // Recalculate dimensions and positions inside the scroll handler
            // This ensures the values are always correct, even if images load late
            const stickyTopOffset = 80; // This is the 'top' value from the '.sidebar-fixed' CSS class
            const mainLayoutTop = mainLayout.offsetTop;
            const mainLayoutHeight = mainLayout.offsetHeight;
            const sidebarWrapperHeight = sidebarWrapper.offsetHeight;

            // Define the scroll thresholds based on current layout
            // 1. Point where the sidebar should START sticking
            const topThreshold = mainLayoutTop - stickyTopOffset;
            
            // 2. Point where the sidebar should STOP sticking and become absolute
            const bottomThreshold = mainLayoutTop + mainLayoutHeight - sidebarWrapperHeight - stickyTopOffset;

            // Apply logic based on scroll position
            if (scrollTop > topThreshold) {
                if (scrollTop < bottomThreshold) {
                    // State 2: FIXED - Scrolling within the main content
                    sidebarWrapper.classList.add('sidebar-fixed');
                    sidebarWrapper.classList.remove('sidebar-absolute-bottom');
                    sidebarWrapper.style.width = initialWidth + 'px';
                } else {
                    // State 3: ABSOLUTE - Reached the end of the main content
                    sidebarWrapper.classList.remove('sidebar-fixed');
                    sidebarWrapper.classList.add('sidebar-absolute-bottom');
                    sidebarWrapper.style.width = '100%';
                }
            } else {
                // State 1: STATIC - At the top of the page
                sidebarWrapper.classList.remove('sidebar-fixed');
                sidebarWrapper.classList.remove('sidebar-absolute-bottom');
                sidebarWrapper.style.width = '100%';
            }
        }, { passive: true });
    });
    </script>
    </body>
</html>
