<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{{.blog_name}}</title>
    <link rel="stylesheet" href="/themes/JustNews/files/style.css">
    <link rel="stylesheet" href="/themes/JustNews/files/swiper.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body class="m-flex">

{{template "header" .}}

<div id="wrap">
    <div class="container">
        {{if .articles}}
        <div class="carousel-container swiper">
            <div class="swiper-wrapper">
                {{range .articles}}
                {{if .Cover}}
                <div class="swiper-slide">
                    <a href="/article/{{.ID}}">
                        <img src="{{.Cover}}" alt="{{.Title}}">
                    </a>
                </div>
                {{end}}
                {{end}}
            </div>
            <div class="swiper-pagination"></div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>
        </div>
        {{end}}

        <div class="main-layout">
            <div class="left-column">
                <div class="article-list">
                    {{range .articles}}
                    <div class="article-item-box">
                        {{if .Cover}}
                        <div class="article-item-image">
                            <a href="/article/{{.ID}}">
                                <img src="{{.Cover}}" alt="{{.Title}}">
                            </a>
                            <span class="image-category"><a href="/category/{{.Category.ID}}">{{.Category.Name}}</a></span>
                        </div>
                        {{end}}
                        <div class="article-item-content">
                            <h3><a href="/article/{{.ID}}">{{.Title}}</a></h3>
                            <p>{{.Summary}}</p>
                            <div class="article-meta">
                                <span class="meta-date"><i class="far fa-clock"></i> {{.CreatedAt.Format "2006-01-02"}}</span>
                                <span class="meta-category hidden-mobile"><a href="/category/{{.Category.ID}}"><i class="far fa-folder"></i> {{.Category.Name}}</a></span>
                                <span class="views"><i class="far fa-eye"></i> {{.Views}}</span>
                            </div>
                        </div>
                    </div>
                    {{else}}
                    <p>暂无文章</p>
                    {{end}}
                </div>
                <div class="pagination">
                    {{if .prev_page}}
                    <a href="/?page={{.prev_page}}">上一页</a>
                    {{end}}
                    {{if .next_page}}
                    <a href="/?page={{.next_page}}">下一页</a>
                    {{end}}
                </div>
            </div>
            <div class="right-column">
                {{template "sidebar" .}}
            </div>
        </div>
        {{if .friend_links}}
        <div class="friend-links">
            <h2 class="widget-title">友情链接</h2>
            <div class="links-container">
                {{range .friend_links}}
                <a href="{{.URL}}" target="_blank" title="{{.Description}}">{{.Name}}</a>
                {{end}}
            </div>
        </div>
        {{end}}
    </div>
</div>

<div class="search-form-wrap">
    <div class="search-form-inner">
        <form class="search-form" action="/" method="get">
            <input class="search-input" name="s" type="text" placeholder="输入关键字..." autocomplete="off">
            <button class="search-btn" type="submit"><i class="fas fa-search"></i></button>
        </form>
        <div class="search-close"><i class="fas fa-times"></i></div>
    </div>
</div>

{{template "footer" .}}

<script src="/themes/JustNews/files/swiper.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const menuToggle = document.querySelector('.mobile-menu-toggle');
        const closeMenuBtn = document.querySelector('.close-menu-btn');
        const overlay = document.querySelector('.overlay');

        if (menuToggle) {
            menuToggle.addEventListener('click', function () {
                document.body.classList.add('nav-open');
            });
        }

        if (closeMenuBtn) {
            closeMenuBtn.addEventListener('click', function () {
                document.body.classList.remove('nav-open');
            });
        }
        
        if (overlay) {
            overlay.addEventListener('click', function () {
                document.body.classList.remove('nav-open');
            });
        }

        const submenuToggles = document.querySelectorAll('.submenu-toggle');
        submenuToggles.forEach(toggle => {
            toggle.addEventListener('click', function () {
                this.classList.toggle('active');
                const submenu = this.closest('li').querySelector('.sub-menu');
                if (submenu) {
                    submenu.classList.toggle('open');
                }
            });
        });

        const swiper = new Swiper('.swiper', {
            loop: true,
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
            autoplay: {
                delay: 3000,
                disableOnInteraction: false,
            },
        });

        // --- 全屏搜索框控制脚本 ---
        const searchIcon = document.querySelector('.search-icon');
        const searchWrap = document.querySelector('.search-form-wrap');
        const searchClose = document.querySelector('.search-close');
        const searchInput = searchWrap.querySelector('.search-input');

        // 点击顶部搜索图标
        searchIcon.addEventListener('click', function() {
            searchWrap.style.display = 'block';
            // 使用一个小的延时来确保元素已显示，从而让焦点生效
            setTimeout(() => {
                searchInput.focus();
            }, 100);
        });

        // 点击关闭按钮
        searchClose.addEventListener('click', function() {
            searchWrap.style.display = 'none';
        });

        // 按下 ESC 键也可以关闭
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && searchWrap.style.display === 'block') {
                searchWrap.style.display = 'none';
            }
        });
    });
</script>
</body>
</html>
